!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self)["vue-yandex-maps"]={})}(this,function(t){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t){return function(t){if(Array.isArray(t)){for(var e=0,o=new Array(t.length);e<t.length;e++)o[e]=t[e];return o}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function d(t){return t.charAt(0).toUpperCase()+t.slice(1)}function a(t,e){var a=[];return function t(e,o){if(e===o)return!0;if(e instanceof Date&&o instanceof Date)return+e==+o;if("object"!==i(e)||"object"!==i(o))return!1;if(function(t,e){for(var o=a.length;o--;)if(!(a[o][0]!==t&&a[o][0]!==e||a[o][1]!==e&&a[o][1]!==t))return!0;return!1}(e,o))return!0;a.push([e,o]);var r=Object.keys(e),n=r.length;if(Object.keys(o).length!==n)return!1;for(;n--;)if(!t(e[r[n]],o[r[n]]))return!1;return!0}(t,e)}var h=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.events={},this.ymapReady=!1,this.scriptIsNotAttached=!0}return function(t,e,o){e&&r(t.prototype,e),o&&r(t,o)}(t,[{key:"$on",value:function(t,e){var o=this;return this.events[t]||(this.events[t]=[]),this.events[t].push(e),function(){o.events[t]=o.events[t].filter(function(t){return e!==t})}}},{key:"$emit",value:function(t,e){var o=this.events[t];o&&o.forEach(function(t){return t(e)})}}]),t}()),e=["fullscreenControl","geolocationControl","routeEditor","rulerControl","searchControl","trafficControl","typeSelector","zoomControl","routePanelControl"];function o(t){return 0===t.filter(function(t){return![].concat(e,["default"]).includes(t)}).length}function b(t,e){var o=d(t);if(!e)return o;switch(o){case"Placemark":return"Point";case"Polyline":return"LineString";default:return o}}function v(t,e){var o=e?{type:"Feature",id:t.properties.markerId,geometry:{type:t.markerType,coordinates:t.coords},properties:t.properties,options:t.options}:new ymaps[t.markerType](t.coords,t.properties,t.options);return o.clusterName=t.clusterName,e||function(e,o){e&&"object"===i(e)&&Object.keys(e).forEach(function(t){o.events.add(t,e[t])})}(t.callbacks,o),o}function s(){var d=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(t,e){var o=document.createElement("SCRIPT"),r=d.apiKey,n=void 0===r?"":r,a=d.lang,i=void 0===a?"ru_RU":a,s=d.version,c=void 0===s?"2.1":s,l=d.coordorder,u=void 0===l?"latlong":l,p=d.debug,m=void 0!==p&&p?"debug":"release",f="lang=".concat(i).concat(n&&"&apikey=".concat(n),"&mode=").concat(m,"&coordorder=").concat(u),y="https://api-maps.yandex.ru/".concat(c,"/?").concat(f);o.setAttribute("src",y),o.setAttribute("async",""),o.setAttribute("defer",""),document.body.appendChild(o),h.scriptIsNotAttached=!1,o.onload=function(){h.ymapReady=!0,h.$emit("scriptIsLoaded"),t()},o.onerror=e})}var c={pluginOptions:{},data:function(){return{ymapEventBus:h,ymapId:"yandexMap".concat(Math.round(1e5*Math.random())),myMap:{},style:this.ymapClass?"":"width: 100%; height: 100%;"}},props:{coords:{type:Array,validator:function(t){return!t.filter(function(t){return Number.isNaN(t)}).length},required:!0},zoom:{validator:function(t){return!Number.isNaN(t)},default:18},clusterOptions:{type:Object,default:function(){return{}}},clusterCallbacks:{type:Object,default:function(){return{}}},behaviors:{type:Array,default:function(){return["default"]}},controls:{type:Array,default:function(){return["default"]},validator:function(t){return o(t)}},detailedControls:{type:Object,validator:function(t){return o(Object.keys(t))}},scrollZoom:{type:Boolean,default:!0},zoomControl:Object,mapType:{type:String,default:"map",validator:function(t){return["map","satellite","hybrid"].includes(t)}},placemarks:{type:Array,default:function(){return[]}},useObjectManager:{type:Boolean,default:!1},objectManagerClusterize:{type:Boolean,default:!0},ymapClass:String,initWithoutMarkers:{type:Boolean,default:!0},debug:{type:Boolean,default:!1},settings:{type:Object,default:function(){return{}}},options:{type:Object,default:function(){return{}}}},computed:{coordinates:function(){return this.coords.map(function(t){return+t})}},methods:{getMarkersFromSlots:function(){return this.$slots.default?this.$slots.default.map(function(t){var e=t.componentOptions&&t.componentOptions.propsData;if(e){var o={};if(e.balloonTemplate)o={balloonContentLayout:ymaps.templateLayoutFactory.createClass(e.balloonTemplate)};var r={markerId:e.markerId,markerType:e.markerType||"placemark",coords:function e(t){return t.map(function(t){return Array.isArray(t)?e(t):+t})}(e.coords),hintContent:e.hintContent,markerFill:e.markerFill,circleRadius:+e.circleRadius,clusterName:e.clusterName,markerStroke:e.markerStroke,balloon:e.balloon,callbacks:e.callbacks,properties:e.properties,options:e.options,balloonOptions:o};return e.icon&&["default#image","default#imageWithContent"].includes(e.icon.layout)?(r.iconContent=e.icon.content,r.iconLayout=e.icon.layout,r.iconImageHref=e.icon.imageHref,r.iconImageSize=e.icon.imageSize,r.iconImageOffset=e.icon.imageOffset,r.iconContentOffset=e.icon.contentOffset,e.icon.contentLayout&&"string"==typeof e.icon.contentLayout&&(r.iconContentLayout=ymaps.templateLayoutFactory.createClass(e.icon.contentLayout))):r.icon=e.icon,r}}).filter(function(t){return t&&t.markerType}):[]},createMarkers:function(){for(var t,f=this,y=[],e=this.getMarkersFromSlots(),o=0;o<e.length;o++){var r=e[o],n=b(r.markerType,this.useObjectManager),a={hintContent:r.hintContent,iconContent:r.icon?r.icon.content:r.iconContent,markerId:r.markerId},i=r.balloon?{balloonContentHeader:r.balloon.header,balloonContentBody:r.balloon.body,balloonContentFooter:r.balloon.footer}:{},s=Object.assign(a,i,r.properties),c=r.iconLayout?{iconLayout:r.iconLayout,iconImageHref:r.iconImageHref,iconImageSize:r.iconImageSize,iconImageOffset:r.iconImageOffset,iconContentOffset:r.iconContentOffset,iconContentLayout:r.iconContentLayout}:{preset:r.icon&&"islands#".concat((t=r,(t.icon.color||"blue")+(t.icon.glyph?d(t.icon.glyph):t.icon.content?"Stretchy":"")),"Icon")},l=r.markerStroke?{strokeColor:r.markerStroke.color||"0066ffff",strokeOpacity:0<=parseFloat(r.markerStroke.opacity)?parseFloat(r.markerStroke.opacity):1,strokeStyle:r.markerStroke.style,strokeWidth:0<=parseFloat(r.markerStroke.width)?parseFloat(r.markerStroke.width):1}:{},u=r.markerFill?{fill:r.markerFill.enabled||!0,fillColor:r.markerFill.color||"0066ff99",fillOpacity:0<=parseFloat(r.markerFill.opacity)?parseFloat(r.markerFill.opacity):1,fillImageHref:r.markerFill.imageHref||""}:{},p=Object.assign(c,l,u,r.balloonOptions,r.options);"Circle"===n&&(r.coords=[r.coords,r.circleRadius]);var m=v({properties:s,options:p,markerType:n,coords:r.coords,clusterName:r.clusterName,callbacks:r.callbacks},this.useObjectManager);y.push(m)}return this.placemarks&&this.placemarks.forEach(function(t){var e=t.markerType,o=void 0===e?"Placemark":e,r=t.properties,n=t.options,a=void 0===n?{}:n,i=t.coords,s=t.clusterName,c=t.callbacks,l=t.balloonTemplate,u=b(o,f.useObjectManager);if(l){var p=ymaps.templateLayoutFactory.createClass(l);a.balloonContentLayout=p}var m=v({properties:r,options:a,markerType:u,coords:i,clusterName:s,callbacks:c},f.useObjectManager);y.push(m)}),y},setMarkers:function(){var t={options:this.clusterOptions,callbacks:this.clusterCallbacks,map:this.myMap,useObjectManager:this.useObjectManager,objectManagerClusterize:this.objectManagerClusterize};!function(t,e){var c=e.options,l=e.callbacks,u=e.map,p=e.useObjectManager,m=e.objectManagerClusterize,f={},o=[];if(t.forEach(function(t){t.clusterName?f[t.clusterName]=f[t.clusterName]?[].concat(n(f[t.clusterName]),[t]):[t]:o.push(t)}),Object.keys(f).forEach(function(t){var e=c[t]||{},o=l[t]||{},r=e.layout||"\n      <div>{{ properties.balloonContentHeader }}</div>\n      <div>{{ properties.balloonContentBody }}</div>\n      <div>{{ properties.balloonContentFooter }}</div>\n    ";e.clusterBalloonItemContentLayout=ymaps.templateLayoutFactory.createClass(r);var n=e.clusterLayout?ymaps.templateLayoutFactory.createClass(e.clusterLayout):e.clusterBalloonContentLayout||"cluster#balloonTwoColumns";e.clusterBalloonContentLayout=n;var a=e.clusterIconContentLayout;if(e.clusterIconContentLayout=a&&ymaps.templateLayoutFactory.createClass(a),p){var i=new ymaps.ObjectManager(Object.assign({clusterize:m},e));Object.keys(o).forEach(function(t){i.clusters.events.add(t,o[t])}),i.add(f[t]),u.geoObjects.add(i)}else{var s=new ymaps.Clusterer(e);Object.keys(o).forEach(function(t){s.events.add(t,o[t])}),e.createCluster&&(s.createCluster=e.createCluster),s.add(f[t]),u.geoObjects.add(s)}}),o.length){var r=p?new ymaps.ObjectManager({clusterize:!1}):new ymaps.GeoObjectCollection;o.forEach(function(t){return r.add(t)}),u.geoObjects.add(r)}}(this.createMarkers(),t)},init:function(){var e=this;if(window.ymaps&&ymaps.GeoObjectCollection&&(this.initWithoutMarkers||this.$slots.default||this.placemarks.length)){if(this.$emit("map-initialization-started"),this.myMap=new ymaps.Map(this.ymapId,{center:this.coordinates,zoom:+this.zoom,behaviors:this.behaviors,controls:this.controls,type:"yandex#".concat(this.mapType)},this.options),this.myMap.events.add("click",function(t){return e.$emit("click",t)}),this.zoomControl&&(this.myMap.controls.remove("zoomControl"),this.myMap.controls.add(new ymaps.control.ZoomControl(this.zoomControl))),this.detailedControls)Object.keys(this.detailedControls).forEach(function(t){e.myMap.controls.remove(t),e.myMap.controls.add(t,e.detailedControls[t])});!1===this.scrollZoom&&this.myMap.behaviors.disable("scrollZoom"),this.setMarkers(),this.$emit("map-was-initialized",this.myMap)}}},watch:{coordinates:function(t){this.myMap.panTo&&this.myMap.panTo(t)},placemarks:function(){window.ymaps&&(this.myMap.geoObjects&&this.myMap.geoObjects.removeAll(),this.setMarkers())},zoom:function(){this.myMap.setZoom(this.zoom)}},render:function(t){return t("section",{class:"ymap-container",ref:"mapContainer"},[t("div",{attrs:{id:this.ymapId,class:this.ymapClass,style:this.style}}),t("div",{ref:"markersContainer",attrs:{class:"ymap-markers"}},[this.$slots.default])])},mounted:function(){var t=this;if(this.$attrs["map-link"]||this.$attrs.mapLink)throw new Error("Vue-yandex-maps: Attribute mapLink is not supported. Use settings.");this.markerObserver=new MutationObserver(function(){t.myMap.geoObjects&&t.myMap.geoObjects.removeAll(),t.setMarkers()}),this.mapObserver=new MutationObserver(function(){t.myMap.container.fitToViewport()});var e=this.$refs,o=e.markersContainer,r=e.mapContainer;if(this.markerObserver.observe(o,{attributes:!0,childList:!0,characterData:!0,subtree:!0}),this.mapObserver.observe(r,{attributes:!0,childList:!0,characterData:!0,subtree:!1}),this.ymapEventBus.scriptIsNotAttached){var n=this.debug;s(function(n){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},e=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(a).filter(function(t){return Object.getOwnPropertyDescriptor(a,t).enumerable}))),e.forEach(function(t){var e,o,r;e=n,r=a[o=t],o in e?Object.defineProperty(e,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[o]=r})}return n}({},this.$options.pluginOptions,this.settings,{debug:n}))}this.ymapEventBus.ymapReady?ymaps.ready(this.init):this.ymapEventBus.$on("scriptIsLoaded",function(){t.ymapEventBus.updateMap=function(){t.myMap.geoObjects&&t.myMap.geoObjects.removeAll(),t.setMarkers()},ymaps.ready(t.init)})},beforeDestroy:function(){this.myMap.geoObjects&&this.myMap.geoObjects.removeAll(),this.markerObserver.disconnect()}},l=["placemark","polyline","rectangle","polygon","circle"],u={data:function(){return{ymapEventBus:h,unwatchArr:[]}},props:{coords:{type:Array,required:!0,validator:function(t){return!t.filter(function(t){return Number.isNaN(t)}).length}},hintContent:String,icon:Object,balloon:Object,markerType:{type:String,validator:function(t){return l.includes(t.toLowerCase())},default:"placemark"},markerFill:Object,markerStroke:Object,clusterName:String,circleRadius:{validator:function(t){return!Number.isNaN(t)},default:1e3},callbacks:Object,balloonTemplate:String,markerId:{type:[String,Number],required:!0},properties:Object,options:Object},render:function(){},mounted:function(){var o=this;Object.keys(this.$props).forEach(function(t){o.unwatchArr.push(o.$watch(t,function(t,e){return function(t,e,o){a(t,e)||(o.rerender&&clearTimeout(o.rerender),o.rerender=setTimeout(function(){return o.updateMap&&o.updateMap()},10))}(t,e,o.ymapEventBus)}))})},beforeDestroy:function(){this.unwatchArr.forEach(function(t){return t()})}};c.install=function(t,e){var o=1<arguments.length&&void 0!==e?e:{};c.pluginOptions=o,t.component("yandex-map",c),t.component("ymap-marker",u)},"undefined"!=typeof window&&window.Vue&&window.Vue.use(c);var p=s,m=c,f=u;t.loadYmap=p,t.yandexMap=m,t.ymapMarker=f,t.default=c,Object.defineProperty(t,"__esModule",{value:!0})});
