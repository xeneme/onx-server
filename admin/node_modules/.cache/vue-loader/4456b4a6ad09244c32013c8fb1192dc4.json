{"remainingRequest":"/mnt/d/Working_Area/DEV/CUSTOMERS/onyxian/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/mnt/d/Working_Area/DEV/CUSTOMERS/onyxian/admin/src/components/dashboard/DashboardSupport.vue?vue&type=script&lang=js&","dependencies":[{"path":"/mnt/d/Working_Area/DEV/CUSTOMERS/onyxian/admin/src/components/dashboard/DashboardSupport.vue","mtime":1603529868026},{"path":"/mnt/d/Working_Area/DEV/CUSTOMERS/onyxian/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/mnt/d/Working_Area/DEV/CUSTOMERS/onyxian/admin/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/mnt/d/Working_Area/DEV/CUSTOMERS/onyxian/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/mnt/d/Working_Area/DEV/CUSTOMERS/onyxian/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/mnt/d/Working_Area/DEV/CUSTOMERS/onyxian/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgQ2hhdCBmcm9tICcuLi91aS9jaGF0L0NoYXQnDQppbXBvcnQgVmFDYXJkTm9EYXRhIGZyb20gJy4vY29tcG9uZW50cy9WYUNhcmROb0RhdGEnDQppbXBvcnQgKiBhcyBTdXBwb3J0IGZyb20gJy4uLy4uL3NlcnZpY2VzL1N1cHBvcnQnDQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogJ2Rhc2hib2FyZC1zdXBwb3J0JywNCiAgY29tcG9uZW50czogeyBDaGF0LCBWYUNhcmROb0RhdGEgfSwNCiAgcHJvcHM6IHsNCiAgICBsb2FkaW5nOiBCb29sZWFuLA0KICB9LA0KICBkYXRhOiAoKSA9PiAoew0KICAgIHVzZXI6IHsNCiAgICAgIGlkOiAnJywNCiAgICAgIG5hbWU6ICcnLA0KICAgICAgc3VwcG9ydE1lc3NhZ2VzOiBbXSwNCiAgICB9LA0KICAgIGxvYWRpbmc6IGZhbHNlLA0KICAgIGl0c0FkbWluOiB0cnVlLA0KICB9KSwNCiAgbWV0aG9kczogew0KICAgIHN0YXJ0RmV0Y2hpbmdNZXNzYWdlcygpIHsNCiAgICAgIFN1cHBvcnQuZmV0Y2hNZXNzYWdlcyh0aGlzLnVzZXIuaWQpDQogICAgICAgIC50aGVuKCh7IGRhdGEgfSkgPT4gew0KICAgICAgICAgIHRoaXMudXNlci5zdXBwb3J0TWVzc2FnZXMgPSBkYXRhLm1lc3NhZ2VzDQogICAgICAgICAgc2V0VGltZW91dCh0aGlzLnN0YXJ0RmV0Y2hpbmdNZXNzYWdlcywgMjAwMCkNCiAgICAgICAgfSkNCiAgICAgICAgLmNhdGNoKGVyciA9PiB7DQogICAgICAgICAgY29uc29sZS5sb2coZXJyKQ0KICAgICAgICB9KQ0KICAgIH0sDQogICAgc2VuZE1lc3NhZ2UobWVzc2FnZSkgew0KICAgICAgbGV0IGkgPSB0aGlzLnVzZXIuc3VwcG9ydE1lc3NhZ2VzLmxlbmd0aA0KDQogICAgICB0aGlzLnVzZXIuc3VwcG9ydE1lc3NhZ2VzLnB1c2gobWVzc2FnZSkNCg0KICAgICAgU3VwcG9ydC5zZW5kTWVzc2FnZSh0aGlzLnVzZXIuaWQsIG1lc3NhZ2UudGV4dCkudGhlbigoeyBkYXRhIH0pID0+IHsNCiAgICAgICAgdGhpcy51c2VyLnN1cHBvcnRNZXNzYWdlc1tpXSA9IGRhdGEubWVzc2FnZQ0KICAgICAgICB0aGlzLnVzZXIuc3VwcG9ydE1lc3NhZ2VzID0gdGhpcy51c2VyLnN1cHBvcnRNZXNzYWdlcy5zbGljZSgpDQogICAgICB9KQ0KICAgIH0sDQogICAgZ2V0dGluZ0RpYWxvZ3VlKCkgew0KICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZQ0KICAgIH0sDQogICAgb3BlbkRpYWxvZ3VlKHsgdXNlciwgbWVzc2FnZXMgfSkgew0KICAgICAgdGhpcy51bnJlYWQgPSAwDQogICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZQ0KICAgICAgdGhpcy5pdHNBZG1pbiA9IHVzZXIucm9sZSAhPSAndXNlcicNCiAgICAgIHRoaXMudXNlci5pZCA9IHVzZXIuaWQNCiAgICAgIHRoaXMudXNlci5uYW1lID0gdXNlci5uYW1lDQoNCiAgICAgIGlmICghdGhpcy5pdHNBZG1pbikgew0KICAgICAgICB0aGlzLnVzZXIuc3VwcG9ydE1lc3NhZ2VzID0gbWVzc2FnZXMNCiAgICAgICAgc2V0VGltZW91dCh0aGlzLnN0YXJ0RmV0Y2hpbmdNZXNzYWdlcywgMjAwMCkNCiAgICAgIH0NCiAgICB9LA0KICB9LA0KICBjb21wdXRlZDogew0KICAgIGNvbXB1dGVkU3R5bGUoKSB7DQogICAgICByZXR1cm4gew0KICAgICAgICBjb2xvcjogdGhpcy4kdGhlbWVzLmJyaWdodEZvcmVncm91bmQsDQogICAgICAgIG9wYWNpdHk6IHRoaXMubG9hZGluZyA/IDAuMiA6IDEsDQogICAgICB9DQogICAgfSwNCiAgICBjb21wdXRlZFdpZGdldFN0eWxlKCkgew0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgY29sb3I6IHRoaXMuJHRoZW1lcy5icmlnaHRGb3JlZ3JvdW5kLA0KICAgICAgfQ0KICAgIH0sDQogIH0sDQogIGNyZWF0ZWQoKSB7DQogICAgdGhpcy4kcm9vdC4kb24oJ29wZW4tZGlhbG9ndWUnLCB0aGlzLm9wZW5EaWFsb2d1ZSkNCiAgICB0aGlzLiRyb290LiRvbignZ2V0dGluZy1kaWFsb2d1ZScsIHRoaXMuZ2V0dGluZ0RpYWxvZ3VlKQ0KICB9LA0KICBiZWZvcmVEZXN0cm95KCkgew0KICAgIHRoaXMuJHJvb3QuJG9mZignb3Blbi1kaWFsb2d1ZScsIHRoaXMub3BlbkRpYWxvZ3VlKQ0KICAgIHRoaXMuJHJvb3QuJG9mZignZ2V0dGluZy1kaWFsb2d1ZScsIHRoaXMuZ2V0dGluZ0RpYWxvZ3VlKQ0KICB9LA0KfQ0K"},{"version":3,"sources":["DashboardSupport.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6BA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"DashboardSupport.vue","sourceRoot":"src/components/dashboard","sourcesContent":["<template>\r\n  <va-card\r\n    :color=\"$themes.background\"\r\n    :style=\"computedWidgetStyle\"\r\n    :title=\"$t('dashboard.support.title')\"\r\n  >\r\n    <h6\r\n      slot=\"actions\"\r\n      class=\"user-title\"\r\n      :style=\"{ color: $themes.foreground }\"\r\n    >\r\n      <va-icon name=\"fa fa-user-circle\" class=\"mr-2\"></va-icon>\r\n      {{ user.name }}\r\n    </h6>\r\n    <va-inner-loading :loading=\"!itsAdmin && loading\">\r\n      <div v-if=\"!itsAdmin\" class=\"tab\" :style=\"computedStyle\">\r\n        <chat :value=\"user.supportMessages\" @input=\"sendMessage\" />\r\n      </div>\r\n      <VaCardNoData\r\n        v-else\r\n        :loading=\"loading\"\r\n        LT=\"Fetching support messages...\"\r\n        ET=\"Can't talk to this person\"\r\n      />\r\n    </va-inner-loading>\r\n  </va-card>\r\n</template>\r\n\r\n<script>\r\nimport Chat from '../ui/chat/Chat'\r\nimport VaCardNoData from './components/VaCardNoData'\r\nimport * as Support from '../../services/Support'\r\n\r\nexport default {\r\n  name: 'dashboard-support',\r\n  components: { Chat, VaCardNoData },\r\n  props: {\r\n    loading: Boolean,\r\n  },\r\n  data: () => ({\r\n    user: {\r\n      id: '',\r\n      name: '',\r\n      supportMessages: [],\r\n    },\r\n    loading: false,\r\n    itsAdmin: true,\r\n  }),\r\n  methods: {\r\n    startFetchingMessages() {\r\n      Support.fetchMessages(this.user.id)\r\n        .then(({ data }) => {\r\n          this.user.supportMessages = data.messages\r\n          setTimeout(this.startFetchingMessages, 2000)\r\n        })\r\n        .catch(err => {\r\n          console.log(err)\r\n        })\r\n    },\r\n    sendMessage(message) {\r\n      let i = this.user.supportMessages.length\r\n\r\n      this.user.supportMessages.push(message)\r\n\r\n      Support.sendMessage(this.user.id, message.text).then(({ data }) => {\r\n        this.user.supportMessages[i] = data.message\r\n        this.user.supportMessages = this.user.supportMessages.slice()\r\n      })\r\n    },\r\n    gettingDialogue() {\r\n      this.loading = true\r\n    },\r\n    openDialogue({ user, messages }) {\r\n      this.unread = 0\r\n      this.loading = false\r\n      this.itsAdmin = user.role != 'user'\r\n      this.user.id = user.id\r\n      this.user.name = user.name\r\n\r\n      if (!this.itsAdmin) {\r\n        this.user.supportMessages = messages\r\n        setTimeout(this.startFetchingMessages, 2000)\r\n      }\r\n    },\r\n  },\r\n  computed: {\r\n    computedStyle() {\r\n      return {\r\n        color: this.$themes.brightForeground,\r\n        opacity: this.loading ? 0.2 : 1,\r\n      }\r\n    },\r\n    computedWidgetStyle() {\r\n      return {\r\n        color: this.$themes.brightForeground,\r\n      }\r\n    },\r\n  },\r\n  created() {\r\n    this.$root.$on('open-dialogue', this.openDialogue)\r\n    this.$root.$on('getting-dialogue', this.gettingDialogue)\r\n  },\r\n  beforeDestroy() {\r\n    this.$root.$off('open-dialogue', this.openDialogue)\r\n    this.$root.$off('getting-dialogue', this.gettingDialogue)\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.tab {\r\n  height: 100%;\r\n}\r\n\r\n.no-data {\r\n  min-height: 65px;\r\n  padding-top: 0.5rem;\r\n  font-size: 1.2rem;\r\n  text-align: center;\r\n}\r\n\r\n.user-title {\r\n  font-size: 0.8rem;\r\n  letter-spacing: 0.06rem;\r\n  font-weight: 500;\r\n  text-transform: uppercase;\r\n}\r\n</style>\r\n"]}]}