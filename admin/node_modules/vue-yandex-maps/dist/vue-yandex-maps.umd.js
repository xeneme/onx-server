!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self)["vue-yandex-maps"]={})}(this,function(e){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e){return function(e){if(Array.isArray(e)){for(var t=0,o=new Array(e.length);t<e.length;t++)o[t]=e[t];return o}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function h(e){return e.charAt(0).toUpperCase()+e.slice(1)}function s(e,t){var a=[];return function e(t,o){if(t===o)return!0;if(t instanceof Date&&o instanceof Date)return+t==+o;if("object"!==i(t)||"object"!==i(o))return!1;if(function(e,t){for(var o=a.length;o--;)if(!(a[o][0]!==e&&a[o][0]!==t||a[o][1]!==t&&a[o][1]!==e))return!0;return!1}(t,o))return!0;a.push([t,o]);var r=Object.keys(t),n=r.length;if(Object.keys(o).length!==n)return!1;for(;n--;)if(!e(t[r[n]],o[r[n]]))return!1;return!0}(e,t)}var b=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.events={},this.ymapReady=!1,this.scriptIsNotAttached=!0}return function(e,t,o){t&&r(e.prototype,t),o&&r(e,o)}(e,[{key:"$on",value:function(e,t){var o=this;return this.events[e]||(this.events[e]=[]),this.events[e].push(t),function(){o.events[e]=o.events[e].filter(function(e){return t!==e})}}},{key:"$emit",value:function(e,t){var o=this.events[e];o&&o.forEach(function(e){return e(t)})}}]),e}()),t=["fullscreenControl","geolocationControl","routeEditor","rulerControl","searchControl","trafficControl","typeSelector","zoomControl","routePanelControl"];function o(e){return 0===e.filter(function(e){return![].concat(t,["default"]).includes(e)}).length}function k(e,t){var o=h(e);if(!t)return o;switch(o){case"Placemark":return"Point";case"Polyline":return"LineString";default:return o}}function v(e,t){var o=t?{type:"Feature",id:e.properties.markerId,geometry:{type:e.markerType,coordinates:e.coords},properties:e.properties,options:e.options}:new ymaps[e.markerType](e.coords,e.properties,e.options);return o.clusterName=e.clusterName,t||function(t,o){t&&"object"===i(t)&&Object.keys(t).forEach(function(e){o.events.add(e,t[e])})}(e.callbacks,o),o}function a(){var y=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(e,t){var o=document.createElement("SCRIPT"),r=y.apiKey,n=void 0===r?"":r,a=y.lang,i=void 0===a?"ru_RU":a,s=y.version,c=void 0===s?"2.1":s,l=y.coordorder,u=void 0===l?"latlong":l,p=y.debug,m=void 0!==p&&p?"debug":"release",f="lang=".concat(i).concat(n&&"&apikey=".concat(n),"&mode=").concat(m,"&coordorder=").concat(u),d="https://api-maps.yandex.ru/".concat(c,"/?").concat(f);o.setAttribute("src",d),o.setAttribute("async",""),o.setAttribute("defer",""),document.body.appendChild(o),b.scriptIsNotAttached=!1,o.onload=function(){b.ymapReady=!0,b.$emit("scriptIsLoaded"),e()},o.onerror=t})}var c=b,l={pluginOptions:{},provide:function(){var t,n,a=this,o=[],i=[];return{deleteMarker:function(e){a.myMap.geoObjects&&(o.push(e),t&&clearTimeout(t),t=setTimeout(function(){return a.deleteMarkers(o)},10))},rerender:null,compareValues:function(e){var t=e.newVal,o=e.oldVal,r=e.id;s(t,o)||(i.push(r),n&&clearTimeout(n),n=setTimeout(function(){a.setMarkers(i),i=[]},10))}}},data:function(){return{ymapId:"yandexMap".concat(Math.round(1e5*Math.random())),myMap:{},style:this.ymapClass?"":"width: 100%; height: 100%;"}},props:{coords:{type:Array,validator:function(e){return!e.filter(function(e){return Number.isNaN(e)}).length},required:!0},zoom:{validator:function(e){return!Number.isNaN(e)},default:18},clusterOptions:{type:Object,default:function(){return{}}},clusterCallbacks:{type:Object,default:function(){return{}}},behaviors:{type:Array,default:function(){return["default"]}},controls:{type:Array,default:function(){return["default"]},validator:function(e){return o(e)}},detailedControls:{type:Object,validator:function(e){return o(Object.keys(e))}},scrollZoom:{type:Boolean,default:!0},zoomControl:Object,mapType:{type:String,default:"map",validator:function(e){return["map","satellite","hybrid"].includes(e)}},placemarks:{type:Array,default:function(){return[]}},useObjectManager:{type:Boolean,default:!1},objectManagerClusterize:{type:Boolean,default:!0},ymapClass:String,initWithoutMarkers:{type:Boolean,default:!0},debug:{type:Boolean,default:!1},settings:{type:Object,default:function(){return{}}},options:{type:Object,default:function(){return{}}},showAllMarkers:Boolean},computed:{coordinates:function(){return this.coords.map(function(e){return+e})}},methods:{getMarkersFromSlots:function(n){return this.$slots.default?this.$slots.default.map(function(e){var t=e.componentOptions&&e.componentOptions.propsData;if(t&&(!n||n.includes(t.markerId))){var o={};if(t.balloonTemplate)o={balloonContentLayout:ymaps.templateLayoutFactory.createClass(t.balloonTemplate)};var r={markerId:t.markerId,markerType:t.markerType||"placemark",coords:function t(e){return e.map(function(e){return Array.isArray(e)?t(e):+e})}(t.coords),hintContent:t.hintContent,markerFill:t.markerFill,circleRadius:+t.circleRadius,clusterName:t.clusterName,markerStroke:t.markerStroke,balloon:t.balloon,callbacks:t.callbacks,properties:t.properties,options:t.options,balloonOptions:o};return t.icon&&["default#image","default#imageWithContent"].includes(t.icon.layout)?(r.iconContent=t.icon.content,r.iconLayout=t.icon.layout,r.iconImageHref=t.icon.imageHref,r.iconImageSize=t.icon.imageSize,r.iconImageOffset=t.icon.imageOffset,r.iconContentOffset=t.icon.contentOffset,t.icon.contentLayout&&"string"==typeof t.icon.contentLayout&&(r.iconContentLayout=ymaps.templateLayoutFactory.createClass(t.icon.contentLayout))):r.icon=t.icon,r}}).filter(function(e){return e&&e.markerType}):[]},createMarkers:function(e){var t,f=this,d=[],o=this.getMarkersFromSlots(e);e&&this.deleteMarkers(e);for(var r=0;r<o.length;r++){var n=o[r],a=k(n.markerType,this.useObjectManager),i={hintContent:n.hintContent,iconContent:n.icon?n.icon.content:n.iconContent,markerId:n.markerId},s=n.balloon?{balloonContentHeader:n.balloon.header,balloonContentBody:n.balloon.body,balloonContentFooter:n.balloon.footer}:{},c=Object.assign(i,s,n.properties),l=n.iconLayout?{iconLayout:n.iconLayout,iconImageHref:n.iconImageHref,iconImageSize:n.iconImageSize,iconImageOffset:n.iconImageOffset,iconContentOffset:n.iconContentOffset,iconContentLayout:n.iconContentLayout}:{preset:n.icon&&"islands#".concat((t=n,(t.icon.color||"blue")+(t.icon.glyph?h(t.icon.glyph):t.icon.content?"Stretchy":"")),"Icon")},u=n.markerStroke?{strokeColor:n.markerStroke.color||"0066ffff",strokeOpacity:0<=parseFloat(n.markerStroke.opacity)?parseFloat(n.markerStroke.opacity):1,strokeStyle:n.markerStroke.style,strokeWidth:0<=parseFloat(n.markerStroke.width)?parseFloat(n.markerStroke.width):1}:{},p=n.markerFill?{fill:n.markerFill.enabled||!0,fillColor:n.markerFill.color||"0066ff99",fillOpacity:0<=parseFloat(n.markerFill.opacity)?parseFloat(n.markerFill.opacity):1,fillImageHref:n.markerFill.imageHref||""}:{},m=Object.assign(l,u,p,n.balloonOptions,n.options);"Circle"===a&&(n.coords=[n.coords,n.circleRadius]);var y=v({properties:c,options:m,markerType:a,coords:n.coords,clusterName:n.clusterName,callbacks:n.callbacks},this.useObjectManager);d.push(y)}return this.placemarks&&this.placemarks.forEach(function(e){var t=e.markerType,o=void 0===t?"Placemark":t,r=e.properties,n=e.options,a=void 0===n?{}:n,i=e.coords,s=e.clusterName,c=e.callbacks,l=e.balloonTemplate,u=k(o,f.useObjectManager);if(l){var p=ymaps.templateLayoutFactory.createClass(l);a.balloonContentLayout=p}var m=v({properties:r,options:a,markerType:u,coords:i,clusterName:s,callbacks:c},f.useObjectManager);d.push(m)}),d},setMarkers:function(e){var t={options:this.clusterOptions,callbacks:this.clusterCallbacks,map:this.myMap,useObjectManager:this.useObjectManager,objectManagerClusterize:this.objectManagerClusterize};!function(e,t){var c=t.options,l=t.callbacks,u=t.map,p=t.useObjectManager,m=t.objectManagerClusterize,f={},o=[];if(e.forEach(function(e){e.clusterName?f[e.clusterName]=f[e.clusterName]?[].concat(n(f[e.clusterName]),[e]):[e]:o.push(e)}),Object.keys(f).forEach(function(e){var t=c[e]||{},o=l[e]||{},r=t.layout||"\n      <div>{{ properties.balloonContentHeader }}</div>\n      <div>{{ properties.balloonContentBody }}</div>\n      <div>{{ properties.balloonContentFooter }}</div>\n    ";t.clusterBalloonItemContentLayout=ymaps.templateLayoutFactory.createClass(r);var n=t.clusterLayout?ymaps.templateLayoutFactory.createClass(t.clusterLayout):t.clusterBalloonContentLayout||"cluster#balloonTwoColumns";t.clusterBalloonContentLayout=n;var a=t.clusterIconContentLayout;if(t.clusterIconContentLayout=a&&ymaps.templateLayoutFactory.createClass(a),p){var i=new ymaps.ObjectManager(Object.assign({clusterize:m},t));Object.keys(o).forEach(function(e){i.clusters.events.add(e,o[e])}),i.add(f[e]),u.geoObjects.add(i)}else{var s=new ymaps.Clusterer(t);Object.keys(o).forEach(function(e){s.events.add(e,o[e])}),t.createCluster&&(s.createCluster=t.createCluster),s.add(f[e]),u.geoObjects.add(s)}}),o.length){var r=p?new ymaps.ObjectManager({clusterize:!1}):new ymaps.GeoObjectCollection;o.forEach(function(e){return r.add(e)}),u.geoObjects.add(r)}}(this.createMarkers(e),t),e&&this.$emit("markers-was-change",e)},deleteMarkers:function(a){var i=this;this.myMap.geoObjects.each(function(t){var o=[];if(i.useObjectManager)t.remove(a);else{var e,r=function(e){var t=e.properties.get("markerId");a.includes(t)&&o.push(e)};if(t.each)t.each(r),e=t.getLength();else{var n=t.getGeoObjects();n.forEach(r),e=n.length}0===e||e===o.length?i.myMap.geoObjects.remove(t):o.length&&o.forEach(function(e){return t.remove(e)})}}),this.$emit("markers-was-delete",a)},init:function(){var t=this;if(window.ymaps&&ymaps.GeoObjectCollection&&(this.initWithoutMarkers||this.$slots.default||this.placemarks.length)){if(this.$emit("map-initialization-started"),this.myMap=new ymaps.Map(this.ymapId,{center:this.coordinates,zoom:+this.zoom,behaviors:this.behaviors,controls:this.controls,type:"yandex#".concat(this.mapType)},this.options),this.myMap.events.add("click",function(e){return t.$emit("click",e)}),this.zoomControl&&(this.myMap.controls.remove("zoomControl"),this.myMap.controls.add(new ymaps.control.ZoomControl(this.zoomControl))),this.detailedControls)Object.keys(this.detailedControls).forEach(function(e){t.myMap.controls.remove(e),t.myMap.controls.add(e,t.detailedControls[e])});!1===this.scrollZoom&&this.myMap.behaviors.disable("scrollZoom"),this.setMarkers(),this.showAllMarkers&&this.myMap.setBounds(this.myMap.geoObjects.getBounds()),this.$emit("map-was-initialized",this.myMap)}}},watch:{coordinates:function(e){this.myMap.panTo&&this.myMap.panTo(e)},placemarks:function(){window.ymaps&&(this.myMap.geoObjects&&this.myMap.geoObjects.removeAll(),this.setMarkers())},zoom:function(){this.myMap.setZoom(this.zoom)}},render:function(e){return e("section",{class:"ymap-container",ref:"mapContainer"},[e("div",{attrs:{id:this.ymapId,class:this.ymapClass,style:this.style}}),e("div",{ref:"markersContainer",attrs:{class:"ymap-markers"}},[this.$slots.default])])},mounted:function(){var e=this;if(this.$attrs["map-link"]||this.$attrs.mapLink)throw new Error("Vue-yandex-maps: Attribute mapLink is not supported. Use settings.");this.mapObserver=new MutationObserver(function(){e.myMap.container.fitToViewport()});var t=this.$refs.mapContainer;if(this.mapObserver.observe(t,{attributes:!0,childList:!0,characterData:!0,subtree:!1}),c.scriptIsNotAttached){var o=this.debug;a(function(n){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{},t=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),t.forEach(function(e){var t,o,r;t=n,r=a[o=e],o in t?Object.defineProperty(t,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[o]=r})}return n}({},this.$options.pluginOptions,this.settings,{debug:o}))}c.ymapReady?ymaps.ready(this.init):c.$on("scriptIsLoaded",function(){ymaps.ready(e.init)})},beforeDestroy:function(){this.myMap.geoObjects&&this.myMap.geoObjects.removeAll()}},u=["placemark","polyline","rectangle","polygon","circle"],p=[],m={inject:["deleteMarker","rerender","compareValues"],props:{coords:{type:Array,required:!0,validator:function(e){return!e.filter(function(e){return Number.isNaN(e)}).length}},hintContent:String,icon:Object,balloon:Object,markerType:{type:String,validator:function(e){return u.includes(e.toLowerCase())},default:"placemark"},markerFill:Object,markerStroke:Object,clusterName:[String,Number],circleRadius:{validator:function(e){return!Number.isNaN(e)},default:1e3},callbacks:Object,balloonTemplate:String,markerId:{type:[String,Number],required:!0},properties:Object,options:Object},render:function(){},mounted:function(){var o=this;Object.keys(this.$props).forEach(function(e){p.push(o.$watch(e,function(e,t){return o.compareValues({newVal:e,oldVal:t,id:o.markerId})}))})},beforeDestroy:function(){p.forEach(function(e){return e()}),this.deleteMarker(this.markerId)}};l.install=function(e,t){var o=1<arguments.length&&void 0!==t?t:{};l.pluginOptions=o,e.component("yandex-map",l),e.component("ymap-marker",m)},"undefined"!=typeof window&&window.Vue&&window.Vue.use(l);var f=a,d=l,y=m;e.loadYmap=f,e.yandexMap=d,e.ymapMarker=y,e.default=l,Object.defineProperty(e,"__esModule",{value:!0})});
