function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function n(e){return e.charAt(0).toUpperCase()+e.slice(1)}function a(e){return(e.icon.color||"blue")+(e.icon.glyph?n(e.icon.glyph):e.icon.content?"Stretchy":"")}function i(e){return e.map(function(e){return Array.isArray(e)?i(e):+e})}function s(t,r){var o=[];return function t(r,n){if(r===n)return!0;if(r instanceof Date&&n instanceof Date)return+r==+n;if("object"!==e(r)||"object"!==e(n))return!1;if(function(e,t){for(var r=o.length;r--;)if(!(o[r][0]!==e&&o[r][0]!==t||o[r][1]!==t&&o[r][1]!==e))return!0;return!1}(r,n))return!0;o.push([r,n]);var a=Object.keys(r),i=a.length;if(Object.keys(n).length!==i)return!1;for(;i--;)if(!t(r[a[i]],n[a[i]]))return!1;return!0}(t,r)}var c=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.events={},this.ymapReady=!1,this.scriptIsNotAttached=!0}var r,o,n;return r=e,(o=[{key:"$on",value:function(e,t){var r=this;return this.events[e]||(this.events[e]=[]),this.events[e].push(t),function(){r.events[e]=r.events[e].filter(function(e){return t!==e})}}},{key:"$emit",value:function(e,t){var r=this.events[e];r&&r.forEach(function(e){return e(t)})}}])&&t(r.prototype,o),n&&t(r,n),e}()),l=["fullscreenControl","geolocationControl","routeEditor","rulerControl","searchControl","trafficControl","typeSelector","zoomControl","routePanelControl"];function u(e){return 0===e.filter(function(e){return![].concat(l,["default"]).includes(e)}).length}function p(e,t){var r=n(e);if(!t)return r;switch(r){case"Placemark":return"Point";case"Polyline":return"LineString";default:return r}}function m(t,r){var o,n,a=r?{type:"Feature",id:t.properties.markerId,geometry:{type:t.markerType,coordinates:t.coords},properties:t.properties,options:t.options}:new ymaps[t.markerType](t.coords,t.properties,t.options);return a.clusterName=t.clusterName,r||(o=t.callbacks,n=a,o&&"object"===e(o)&&Object.keys(o).forEach(function(e){n.events.add(e,o[e])})),a}function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(t,r){var o=document.createElement("SCRIPT"),n=e.apiKey,a=void 0===n?"":n,i=e.lang,s=void 0===i?"ru_RU":i,l=e.version,u=void 0===l?"2.1":l,p=e.coordorder,m=void 0===p?"latlong":p,f=e.debug,d=void 0!==f&&f?"debug":"release",y="lang=".concat(s).concat(a&&"&apikey=".concat(a),"&mode=").concat(d,"&coordorder=").concat(m),h="https://api-maps.yandex.ru/".concat(u,"/?").concat(y);o.setAttribute("src",h),o.setAttribute("async",""),o.setAttribute("defer",""),document.body.appendChild(o),c.scriptIsNotAttached=!1,o.onload=function(){c.ymapReady=!0,c.$emit("scriptIsLoaded"),t()},o.onerror=r})}var d=c,y={pluginOptions:{},provide:function(){var e,t,r=this,o=[],n=[];return{deleteMarker:function(t){r.myMap.geoObjects&&(o.push(t),e&&clearTimeout(e),e=setTimeout(function(){return r.deleteMarkers(o)},10))},rerender:null,compareValues:function(e){var o=e.newVal,a=e.oldVal,i=e.id;s(o,a)||(n.push(i),t&&clearTimeout(t),t=setTimeout(function(){r.setMarkers(n),n=[]},10))}}},data:function(){return{ymapId:"yandexMap".concat(Math.round(1e5*Math.random())),myMap:{},style:this.ymapClass?"":"width: 100%; height: 100%;"}},props:{coords:{type:Array,validator:function(e){return!e.filter(function(e){return Number.isNaN(e)}).length},required:!0},zoom:{validator:function(e){return!Number.isNaN(e)},default:18},clusterOptions:{type:Object,default:function(){return{}}},clusterCallbacks:{type:Object,default:function(){return{}}},behaviors:{type:Array,default:function(){return["default"]}},controls:{type:Array,default:function(){return["default"]},validator:function(e){return u(e)}},detailedControls:{type:Object,validator:function(e){return u(Object.keys(e))}},scrollZoom:{type:Boolean,default:!0},zoomControl:Object,mapType:{type:String,default:"map",validator:function(e){return["map","satellite","hybrid"].includes(e)}},placemarks:{type:Array,default:function(){return[]}},useObjectManager:{type:Boolean,default:!1},objectManagerClusterize:{type:Boolean,default:!0},ymapClass:String,initWithoutMarkers:{type:Boolean,default:!0},debug:{type:Boolean,default:!1},settings:{type:Object,default:function(){return{}}},options:{type:Object,default:function(){return{}}},showAllMarkers:Boolean},computed:{coordinates:function(){return this.coords.map(function(e){return+e})}},methods:{getMarkersFromSlots:function(e){return this.$slots.default?this.$slots.default.map(function(t){var r=t.componentOptions&&t.componentOptions.propsData;if(r&&(!e||e.includes(r.markerId))){var o={};if(r.balloonTemplate)o={balloonContentLayout:ymaps.templateLayoutFactory.createClass(r.balloonTemplate)};var n={markerId:r.markerId,markerType:r.markerType||"placemark",coords:i(r.coords),hintContent:r.hintContent,markerFill:r.markerFill,circleRadius:+r.circleRadius,clusterName:r.clusterName,markerStroke:r.markerStroke,balloon:r.balloon,callbacks:r.callbacks,properties:r.properties,options:r.options,balloonOptions:o};return r.icon&&["default#image","default#imageWithContent"].includes(r.icon.layout)?(n.iconContent=r.icon.content,n.iconLayout=r.icon.layout,n.iconImageHref=r.icon.imageHref,n.iconImageSize=r.icon.imageSize,n.iconImageOffset=r.icon.imageOffset,n.iconContentOffset=r.icon.contentOffset,r.icon.contentLayout&&"string"==typeof r.icon.contentLayout&&(n.iconContentLayout=ymaps.templateLayoutFactory.createClass(r.icon.contentLayout))):n.icon=r.icon,n}}).filter(function(e){return e&&e.markerType}):[]},createMarkers:function(e){var t=this,r=[],o=this.getMarkersFromSlots(e);e&&this.deleteMarkers(e);for(var n=0;n<o.length;n++){var i=o[n],s=p(i.markerType,this.useObjectManager),c={hintContent:i.hintContent,iconContent:i.icon?i.icon.content:i.iconContent,markerId:i.markerId},l=i.balloon?{balloonContentHeader:i.balloon.header,balloonContentBody:i.balloon.body,balloonContentFooter:i.balloon.footer}:{},u=Object.assign(c,l,i.properties),f=i.iconLayout?{iconLayout:i.iconLayout,iconImageHref:i.iconImageHref,iconImageSize:i.iconImageSize,iconImageOffset:i.iconImageOffset,iconContentOffset:i.iconContentOffset,iconContentLayout:i.iconContentLayout}:{preset:i.icon&&"islands#".concat(a(i),"Icon")},d=i.markerStroke?{strokeColor:i.markerStroke.color||"0066ffff",strokeOpacity:parseFloat(i.markerStroke.opacity)>=0?parseFloat(i.markerStroke.opacity):1,strokeStyle:i.markerStroke.style,strokeWidth:parseFloat(i.markerStroke.width)>=0?parseFloat(i.markerStroke.width):1}:{},y=i.markerFill?{fill:i.markerFill.enabled||!0,fillColor:i.markerFill.color||"0066ff99",fillOpacity:parseFloat(i.markerFill.opacity)>=0?parseFloat(i.markerFill.opacity):1,fillImageHref:i.markerFill.imageHref||""}:{},h=Object.assign(f,d,y,i.balloonOptions,i.options);"Circle"===s&&(i.coords=[i.coords,i.circleRadius]);var b=m({properties:u,options:h,markerType:s,coords:i.coords,clusterName:i.clusterName,callbacks:i.callbacks},this.useObjectManager);r.push(b)}return this.placemarks&&this.placemarks.forEach(function(e){var o=e.markerType,n=void 0===o?"Placemark":o,a=e.properties,i=e.options,s=void 0===i?{}:i,c=e.coords,l=e.clusterName,u=e.callbacks,f=e.balloonTemplate,d=p(n,t.useObjectManager);if(f){var y=ymaps.templateLayoutFactory.createClass(f);s.balloonContentLayout=y}var h=m({properties:a,options:s,markerType:d,coords:c,clusterName:l,callbacks:u},t.useObjectManager);r.push(h)}),r},setMarkers:function(e){var t={options:this.clusterOptions,callbacks:this.clusterCallbacks,map:this.myMap,useObjectManager:this.useObjectManager,objectManagerClusterize:this.objectManagerClusterize};!function(e,t){var r=t.options,n=t.callbacks,a=t.map,i=t.useObjectManager,s=t.objectManagerClusterize,c={},l=[];if(e.forEach(function(e){e.clusterName?c[e.clusterName]=c[e.clusterName]?[].concat(o(c[e.clusterName]),[e]):[e]:l.push(e)}),Object.keys(c).forEach(function(e){var t=r[e]||{},o=n[e]||{},l=t.layout||"\n      <div>{{ properties.balloonContentHeader }}</div>\n      <div>{{ properties.balloonContentBody }}</div>\n      <div>{{ properties.balloonContentFooter }}</div>\n    ";t.clusterBalloonItemContentLayout=ymaps.templateLayoutFactory.createClass(l);var u=t.clusterLayout?ymaps.templateLayoutFactory.createClass(t.clusterLayout):t.clusterBalloonContentLayout||"cluster#balloonTwoColumns";t.clusterBalloonContentLayout=u;var p=t.clusterIconContentLayout;if(t.clusterIconContentLayout=p&&ymaps.templateLayoutFactory.createClass(p),i){var m=new ymaps.ObjectManager(Object.assign({clusterize:s},t));Object.keys(o).forEach(function(e){m.clusters.events.add(e,o[e])}),m.add(c[e]),a.geoObjects.add(m)}else{var f=new ymaps.Clusterer(t);Object.keys(o).forEach(function(e){f.events.add(e,o[e])}),t.createCluster&&(f.createCluster=t.createCluster),f.add(c[e]),a.geoObjects.add(f)}}),l.length){var u=i?new ymaps.ObjectManager({clusterize:!1}):new ymaps.GeoObjectCollection;l.forEach(function(e){return u.add(e)}),a.geoObjects.add(u)}}(this.createMarkers(e),t),e&&this.$emit("markers-was-change",e)},deleteMarkers:function(e){var t=this;this.myMap.geoObjects.each(function(r){var o=[];if(t.useObjectManager)r.remove(e);else{var n,a=function(t){var r=t.properties.get("markerId");e.includes(r)&&o.push(t)};if(r.each)r.each(a),n=r.getLength();else{var i=r.getGeoObjects();i.forEach(a),n=i.length}0===n||n===o.length?t.myMap.geoObjects.remove(r):o.length&&o.forEach(function(e){return r.remove(e)})}}),this.$emit("markers-was-delete",e)},init:function(){var e=this;if(window.ymaps&&ymaps.GeoObjectCollection&&(this.initWithoutMarkers||this.$slots.default||this.placemarks.length)){if(this.$emit("map-initialization-started"),this.myMap=new ymaps.Map(this.ymapId,{center:this.coordinates,zoom:+this.zoom,behaviors:this.behaviors,controls:this.controls,type:"yandex#".concat(this.mapType)},this.options),this.myMap.events.add("click",function(t){return e.$emit("click",t)}),this.zoomControl&&(this.myMap.controls.remove("zoomControl"),this.myMap.controls.add(new ymaps.control.ZoomControl(this.zoomControl))),this.detailedControls)Object.keys(this.detailedControls).forEach(function(t){e.myMap.controls.remove(t),e.myMap.controls.add(t,e.detailedControls[t])});!1===this.scrollZoom&&this.myMap.behaviors.disable("scrollZoom"),this.setMarkers(),this.showAllMarkers&&this.myMap.setBounds(this.myMap.geoObjects.getBounds()),this.$emit("map-was-initialized",this.myMap)}}},watch:{coordinates:function(e){this.myMap.panTo&&this.myMap.panTo(e)},placemarks:function(){window.ymaps&&(this.myMap.geoObjects&&this.myMap.geoObjects.removeAll(),this.setMarkers())},zoom:function(){this.myMap.setZoom(this.zoom)}},render:function(e){return e("section",{class:"ymap-container",ref:"mapContainer"},[e("div",{attrs:{id:this.ymapId,class:this.ymapClass,style:this.style}}),e("div",{ref:"markersContainer",attrs:{class:"ymap-markers"}},[this.$slots.default])])},mounted:function(){var e=this;if(this.$attrs["map-link"]||this.$attrs.mapLink)throw new Error("Vue-yandex-maps: Attribute mapLink is not supported. Use settings.");this.mapObserver=new MutationObserver(function(){e.myMap.container.fitToViewport()});var t=this.$refs.mapContainer;if(this.mapObserver.observe(t,{attributes:!0,childList:!0,characterData:!0,subtree:!1}),d.scriptIsNotAttached){var o=this.debug;f(function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},n=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),n.forEach(function(t){r(e,t,o[t])})}return e}({},this.$options.pluginOptions,this.settings,{debug:o}))}d.ymapReady?ymaps.ready(this.init):d.$on("scriptIsLoaded",function(){ymaps.ready(e.init)})},beforeDestroy:function(){this.myMap.geoObjects&&this.myMap.geoObjects.removeAll()}},h=["placemark","polyline","rectangle","polygon","circle"],b=[],k={inject:["deleteMarker","rerender","compareValues"],props:{coords:{type:Array,required:!0,validator:function(e){return!e.filter(function(e){return Number.isNaN(e)}).length}},hintContent:String,icon:Object,balloon:Object,markerType:{type:String,validator:function(e){return h.includes(e.toLowerCase())},default:"placemark"},markerFill:Object,markerStroke:Object,clusterName:[String,Number],circleRadius:{validator:function(e){return!Number.isNaN(e)},default:1e3},callbacks:Object,balloonTemplate:String,markerId:{type:[String,Number],required:!0},properties:Object,options:Object},render:function(){},mounted:function(){var e=this;Object.keys(this.$props).forEach(function(t){b.push(e.$watch(t,function(t,r){return e.compareValues({newVal:t,oldVal:r,id:e.markerId})}))})},beforeDestroy:function(){b.forEach(function(e){return e()}),this.deleteMarker(this.markerId)}};y.install=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};y.pluginOptions=t,e.component("yandex-map",y),e.component("ymap-marker",k)},"undefined"!=typeof window&&window.Vue&&window.Vue.use(y);var g=f,v=y,O=k;export default y;export{g as loadYmap,v as yandexMap,O as ymapMarker};
